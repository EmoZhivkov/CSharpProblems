-- SI-2017-z3

зад. 3:
--------

Напишете скрипт, който ако се изпълнява от root потребителя:

- извежда обобщена информация за
броя и общото количество активна памет (RSS - resident set size, non-swaped
physical memory that a task has used) на текущите процеси на всеки потребител

- ако процесът с най-голяма активна памет на даден потребител използва два пъти
повече памет от средното за потребителя, то скриптът да прекратява изпълнението
му по подходящ начин.

#!/bin/bash

while read user 
do
	info=$(ps -U $user -o pid,rss --sort -rss --noheaders | awk -F' ' 'BEGIN {cnt = 0; first = 0} 
	{ 
		cnt += 1; 
		mem += $2; 
		if (first == 0)
		{
			first = $1
			firstMem = $2
		} 
	} 
	END	{ 
		if (cnt == 0)
		{
			print "0 ---";
			print "0";
		}
		else
		{
			avg = mem / cnt;
			print cnt " " avg;
			if (firstMem > 2 * avg) print first;
			else print "0"; 
		}	
	}')

	displayInfo=$(echo "$info" | head -n 1)
	echo "$user $displayInfo"

	killInfo=$(echo "$info" | tail -n 1)
	if [[ $killInfo -ne 0 ]]
	then
		echo "want to kill $killInfo for user $user"
	fi
done< <(cat /etc/passwd | cut -d':' -f1)